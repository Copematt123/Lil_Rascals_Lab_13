---
title: "Lab_13"
author: "Matthew Copeland"
date: "April 17, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(cowplot)
library(stringr)
library(gapminder)
```
### Overall Question: What does world health look like?

#### Specific Question Kelsey
What is the life expectancy like in North America compared to the world in the 1800's? 
```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
library(stringr)
library(gapminder)
library(forcats)
library(cowplot)
lifeexp <- read_csv("life_expectancy_years.csv")
gapminder2 <- gapminder 



life_exp_year <- function(perms = 1000, country1,year1, n1 ){


  mean_mat <- matrix(0,1000,1)
  for (i in c(1:perms))
  {
    cont1 <- gapminder2 %>% filter(country == country, year ==year1 ) 
    cont2 <- gapminder2 %>% filter(year ==year1 ) 
    rsamp <- sample(cont1, n1, replace = FALSE)
    other <- sample(cont2, length(cont2$lifeExp)-n1, replace = FALSE)

    A <- mean(rsamp)
    B <- mean(other)
    mean_mat[[i]] <- (A-B)
  }
  return(mean_mat)
}
rsample <- as.tibble(life_exp_year(perms = 1000, country=="United States", year1 = 1800, n1=10))

cont3 <- gapminder2 %>% filter(country == ("United States"|"Mexico"|"Canada"), year ==1800 ) 
cont4 <- gapminder2 %>% filter( year ==1800 ) 
life_ex1 <- summary(cont3)
life_ex2 <- summary(cont4)
diff <- median(life_ex1)- median(life_ex2)
std <- sqrt((sd(cont3))^2/length(cont3) + (sd(cont4))^2/length(cont4))
z_score <- diff/std
z_score

ggplot(rsample, aes(x=V1 ))+geom_histogram()+
  xlab("Means")+
  geom_vline(xintercept = diff, color = "red", size = .3)+
  ylab("Number")+
  ggtitle("Difference in Means in Life Expectancy")
cont2 <- gapminder2 %>% filter(year ==2007 ) %>% select(lifeExp)
```





