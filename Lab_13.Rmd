---
title: "Lab_13"
author: "Lil Rascals"
date: "April 17, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(cowplot)
library(stringr)
library(gapminder)
```
### Overall Question: What does world health look like?
This is interesting, because it is essential to note what health is like in your country and countries around the world. We could use this to see what measures should be taken in different countries to improve health. 

#### Specific Question Kelsey
Is health or more specifically smoking in women better in the US than other countries? 
```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
library(stringr)
library(gapminder)
library(forcats)
library(cowplot)
smoke <- read_csv("smoking_women.csv")
  cont2 <- smoke %>% filter(year==2005) %>% select(percent)

    other <- sample(cont2$percent, 20, replace = FALSE)
smoke<-na.omit(smoke) %>% gather('2000', '2002','2005', key = "year", value = "percent")
smokepercent <- function(perms = 1000, year1,country1, n1 ){


  mean_mat <- matrix(0,1000,1)
  for (i in c(1:perms))
  {

    cont1 <- smoke %>% filter(country==country1, year==year1) 
    cont2 <- smoke %>% filter(year==year1) 
    other <- sample(cont2$percent, n1, replace = FALSE)

    A <- mean(cont1$percent)
    B <- mean(other)
    mean_mat[[i]] <- (A-B)
  }
  return(mean_mat)
}

rsample <- as.tibble(smokepercent(perms = 1000,year1=2005,country1="United States",n1=10))

cont3 <- smoke %>% filter(year==2005, country=="United States") %>% select(percent)
cont4 <- smoke %>% filter(year==2005) %>% select(percent)
smoke1 <- summary(cont3$percent)
smoke2 <- summary(cont4$percent)
diff <- median(cont3$percent)- median(cont4$percent)

std <- sqrt( (sd(cont4$percent))^2/length(cont4$percent))
z_score <- diff/std
z_score

ggplot(rsample, aes(x=V1 ))+geom_histogram()+
  xlab("Means")+
  geom_vline(xintercept = diff, color = "red", size = .3)+
  ylab("Number")+
  ggtitle("Difference in Means in Women Smoking in 2005")

```
####Results Kelsey McKenna
I found that there is clear evidence that more people in the United States smoked in 2005 compared with other countries. This data is statistically significant at nearly every level. This shows that we have 11.75% more women who smoke in the United States which may indicate that we could be less healthy and more prone to lung disease than other countries around the world. 



####Specific Question Matthew
Does health spending have an effect on the overall health of a country?


```{r}
#Health spending per person
HSPP <- read_excel("~/ITDS/indicator_per capita total expenditure on health (ppp int. $).xlsx", na = "NA")

#arrange by year which country spends the least and most
HSPP1 <- HSPP %>% gather(key = Year, SPC, `1995.0`:`2010.0`) %>% group_by(Year)
HSPP <- HSPP1 %>% transform(Year = as.numeric(HSPP1$Year), SPC = as.numeric(HSPP1$SPC)) %>% na.omit()
HSPP %>% arrange(desc(SPC))
names(HSPP) <- c("Country", "Year", "SPC")


Spending_per_capita <- function(perms = 1000, country1 , country2 , n1 ){
  mean_mat <- matrix(0,1000,1)
  for (i in c(1:perms))
  {
    cont1 <- HSPP %>% filter(Country == country1) 
    cont2 <- HSPP %>% filter(Country == country2) 

    rcont1 <- sample(cont1, length(cont2$SPC)-n1, replace = FALSE)
    rcont2 <- sample(cont2, length(cont2$SPC)-n1, replace = FALSE)
    
    A <- mean(cont1$SPC)
    B <- mean(cont2$SPC)
    
    mean_mat[[i]] <- (A-B)
  }
  return(mean_mat)
}
rsample <- as.tibble(Spending_per_capita(perms = 1000, country1 = "United States", country2 = "Luxembourg", n1 = 15))
rsample
```

#### Specific Question James
Is health or more specifically smoking in women better in the US than other countries? 
```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
library(stringr)
library(gapminder)
library(forcats)
library(cowplot)
bp <- read_csv("blood_pressure.csv")

HSPP1 <- bp %>% gather(key = Year, SBP, `1980.0`:`2008.0`) %>% group_by(Year)
HSPP <- HSPP1 %>% transform(Year = as.numeric(HSPP1$Year), SPC = as.numeric(HSPP1$SPC)) %>% na.omit()
HSPP %>% arrange(desc(SPC))
names(HSPP) <- c("Country", "Year", "SPC")

Blood_pressure <- function(perms = 1000, country1 , country2 , n1 ){
  mean_mat <- matrix(0,1000,1)
  for (i in c(1:perms))
  {
    cont1 <- bp %>% filter(country == country1) 
    cont2 <- bp %>% filter(country == country2) 

    rcont1 <- sample(cont1, length(cont2$SBP)-n1, replace = FALSE)
    rcont2 <- sample(cont2, length(cont2$SBP)-n1, replace = FALSE)
    
    A <- mean(cont1$SBP)
    B <- mean(cont2$SBP)
    
    mean_mat[[i]] <- (A-B)
  }
  return(mean_mat)
}
s <- as.tibble(Blood_pressure(perms = 1000,country1 = "United States",country2 = "United Kingdom", n1 = 15))

cont3 <- smoke %>% filter(year==2005, country=="United States") %>% select(percent)
cont4 <- smoke %>% filter(year==2005) %>% select(percent)
smoke1 <- summary(cont3$percent)
smoke2 <- summary(cont4$percent)
diff <- median(cont3$percent)- median(cont4$percent)

std <- sqrt( (sd(cont4$percent))^2/length(cont4$percent))
z_score <- diff/std
z_score

ggplot(s, aes(x=V1 ))+
  geom_histogram()+
  xlab("Means")+
  geom_vline(xintercept = diff, color = "red", size = .3)+
  ylab("Number")+
  ggtitle("Difference in Means in Men's Blood Pressure")
```
  
####Results James Burke


###Summary
####Kelsey McKenna
I observed the differences in women who smoke between the US and other countries and conducted a difference of means permutation test to test this claim. I found that women are much more likely to smoke than in other countries. I used the test we learned in class and a function so you could change the year easily and see how it changed or change which country you are comparing very easily. I had to gather the data to get the years in a format that was easier to work with. It had countries years and percent who smoke. 

